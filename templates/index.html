<html>

<head>
    <title>NSO Bridge</title>
    <script src="{{url_for('static', filename='socket.io.js')}}"></script>
    <script type="text/javascript">
        async function getEpsilon(iterations) {
            var epsilon = 0
            for (var i = 0; i < iterations; ++i) {
                const start = Date.now();
                const response = await socket.emitWithAck("sync").catch((e) => { return null; });
                if (response == null) {
                    return null;
                }
                const delay = (Date.now() - start) / 2;
                epsilon += start - (response - delay);
            }
            return Math.round(epsilon / iterations);
        }
        var socket = io();
        var epsilon = null;
        socket.on("connect", async () => {
            const iterations = 5;
            epsilon = await getEpsilon(iterations);
            console.log("epsilon: " + epsilon);
        });

    </script>
</head>

<body>
    Hello world!
</body>

</html>